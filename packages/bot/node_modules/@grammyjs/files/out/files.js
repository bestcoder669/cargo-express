"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getFileMethods = void 0;
const deps_node_js_1 = require("./deps.node.js");
function getFileMethods(linkBuilder, pathBuilder) {
    const methods = {
        getUrl() {
            const path = this.file_path;
            if (path === undefined) {
                const id = this.file_id;
                throw new Error(`File path is not available for file '${id}'`);
            }
            if ((0, deps_node_js_1.isAbsolutePath)(path))
                return pathBuilder(path);
            const link = linkBuilder(path);
            if (link instanceof URL)
                return link.href;
            return link;
        },
        async download(path) {
            const url = this.getUrl();
            path !== null && path !== void 0 ? path : (path = await (0, deps_node_js_1.createTempFile)());
            if ((0, deps_node_js_1.isAbsolutePath)(url))
                await (0, deps_node_js_1.copyFile)(url, path);
            else
                await (0, deps_node_js_1.downloadFile)(url, path);
            return path;
        },
        async *[Symbol.asyncIterator]() {
            const url = this.getUrl();
            if ((0, deps_node_js_1.isAbsolutePath)(url)) {
                yield* (0, deps_node_js_1.readFile)(url);
            }
            else {
                yield* await (0, deps_node_js_1.fetchFile)(url);
            }
        },
    };
    return methods;
}
exports.getFileMethods = getFileMethods;
